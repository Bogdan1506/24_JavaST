USE `pizzeria`;

CREATE TABLE `users`
(
    `identity` INTEGER      NOT NULL AUTO_INCREMENT,
    `login`    VARCHAR(255) NOT NULL UNIQUE,
    `password` CHAR(32)     NOT NULL,
    /*
     * 0 - администратор (Role.ADMINISTRATOR)
     * 1 - регистратор (Role.REGISTRAR)
     * 2 - клиент (Role.CLIENT)
     */
    `role`     TINYINT      NOT NULL CHECK (`role` IN (0, 1, 2)),
    CONSTRAINT PRIMARY KEY (`identity`)
) ENGINE = INNODB
  DEFAULT CHARACTER SET utf8;

CREATE TABLE `pizza`
(
    `codename` TINYINT     NOT NULL,
    `name`     VARCHAR(25) NOT NULL UNIQUE,
    CONSTRAINT PRIMARY KEY (`codename`)
);

CREATE TABLE `dough`
(
    `codename` TINYINT     NOT NULL,
    `name`     VARCHAR(25) NOT NULL UNIQUE,
    CONSTRAINT PRIMARY KEY (`codename`)
);

CREATE TABLE `order`
(
    `order_code` INT     NOT NULL,
    `pizza`      TINYINT NOT NULL,
    `size`       CHAR(1) NOT NULL CHECK ( `size` IN ('S', 'M', 'L')),
    `dough`      TINYINT NOT NULL,
    CONSTRAINT PRIMARY KEY `PK_order` (`order_code`),
    FOREIGN KEY `FK_order_pizza` (`pizza`)
        REFERENCES `pizza` (`codename`),
    FOREIGN KEY `FK_order_dough` (`dough`)
        REFERENCES `dough` (`codename`)
);

CREATE TABLE `method`
(
    `codename` TINYINT     NOT NULL CHECK ( codename IN (1, 2) ),
    `name`     VARCHAR(10) NOT NULL UNIQUE,
    CONSTRAINT PRIMARY KEY `PK_method` (`codename`)
);

CREATE TABLE `basket`
(
    `basket_code` INT     NOT NULL,
    `order_code`  INT     NOT NULL,
    `method`      TINYINT NOT NULL,
    CONSTRAINT PRIMARY KEY `PK_basket` (`basket_code`),
    FOREIGN KEY `FK_basket_order` (`order_code`)
        REFERENCES `order` (`order_code`),
    FOREIGN KEY `FK_basket_method` (`method`)
        REFERENCES `method` (`codename`)
);

CREATE TABLE `delivery`
(
    `delivery_code` INT         NOT NULL,
    `basket_code`   INT         NOT NULL,
    `address`       VARCHAR(25) NOT NULL,
    `delivery_date` DATE        NOT NULL,
    CONSTRAINT PRIMARY KEY `PK_delivery` (`delivery_code`),
    FOREIGN KEY `FK_delivery_basket` (`basket_code`)
        REFERENCES `basket` (`basket_code`)
);